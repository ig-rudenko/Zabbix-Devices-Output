# Telnet Control

Скрипт для автоматического вывода информации оборудования
различных вендоров в удобном для чтения формате:

* Состояние интерфейсов;
* Системная информация;
* MAC-адреса на портах;
* Диагностика кабелей;
* VLAN на портах

#### Список поддерживаемых устройств и функционал

| VENDOR  | interfaces | MAC | sys-info | vlans | cable-diag |
| :----:|:----:|:---:|:----:|:----:|:----:|
| Cisco     | ✅ | ✅ | ✅ | ✅ | - |
| Huawei    | ✅ | ✅ | ✅ | ✅ | ✅ |
| D-Link    | ✅ | ✅ | ✅ | ✅ | ✅ |
| Eltex     | ✅ | ✅ | ✅ | ✅ | -|
| Edge-Core | ✅ | ✅ | ✅ | ✅ | - |
| Extreme   | ✅ | ✅ | ✅ | ✅ | - |
| Q-Tech    | ✅ | ✅ | ✅ | ✅ | ✅ |
| ZTE       | ✅ | ✅ | - | - | - |
| Alcatel   | ✅ | - | - | - | - |
| Lynksys   | ✅ | - | - | - | - |

## Рассмотрим работу на примере

```python

from core.tc import TelnetConnect

session = TelnetConnect(ip='192.168.0.10', device_name='device')
```
- **ip** - обязательный параметр
- **device_name** - опциональный (по умолчанию пустая строка)

После создания экземпляра класса необходимо указать тип авторизации для устройства
##### 1. Авторизация по умолчанию
```python
session.set_authentication()
```
Если не передавать никакие аргументы, то будет произведена попытка авторизироваться как admin/admin
##### 2. Авторизация с помощью логина и пароля
```python
session.set_authentication(login='admin', password='password')
```
##### 3. Авторизация с помощью группы:
```python
session.set_authentication(mode='group', auth_file='./auth.yaml', auth_group='group_1')
```
- **mode** - указывает тип авторизации: group, default, mixed, auto (по умолчанию default)
- **auth_file** - путь к файлу с авторизацией (по умолчанию ./auth.yaml)
- **auth_group** - имя группы, которая находится в файле, указанном в параметре **auth_file** (указывается, если выбран mode='group')

##### 4. Авторизация вперемешку
```python
session.set_authentication(mode='mixed', auth_file='./auth.yaml')
```
Использует для авторизации несколько логинов и паролей, соответственно, и несколько попыток,
которые указаны в файле авторизации **auth_file** (по умолчанию ./auth.yaml) в разделе **MIXED**

Если необходимо использовать другие пары логин/пароль, котороые не указаны в файле, то можно явно передать их с помощью списка

```python
session.set_authentication(login=['admin', 'Admin'], password=['admin', 'password'])
```
Если длина списков различается, то обрезается по меньшему

##### 5. Автоматическая авторизация

```python
session.set_authentication(mode='auto')
```
В данном случае логин и пароль будут выбраны автоматически, если **ip** либо **device_name** принадлежат какой-либо группе в файле авторизации

### Файл auth.yaml

Файл авторизации имеет формат YAML

В нем имеются два раздела:
* **GROUPS** 

Необходим для определения пользовательских групп.
Каждая группа должна иметь логин и пароль. Если при авторизации указать группу, в которой они отсутствуют, 
то будут выбраны логин и пароль по умолчанию (admin, admin)

В разделе **devices_by_ip** необходимо указать IP адреса устройств, к которым будет применяться правило выбора 
логина/пароля при указании автоматической авторизации.
Также возможно автоопределять группу по имени устройства в разделе **devices_by_name**

Можно указывать диапазоны IP адресов используя следующие конструкции:

    192.168.1.0/24   или    192.168.1.32/24

    192.168.1.1             192.168.1.1
    192.168.1.2             192.168.1.2
    ...                     ...
    192.168.1.253           192.168.1.253
    192.168.1.254           192.168.1.254
---
    192.168.1.1-100:    или     192.168.1-3.1-100:

    192.168.1.1                 192.168.1.1
    192.168.1.2                 192.168.1.2
    ...                         ...
    192.168.1.99                192.168.1.100
    192.168.1.100               192.168.2.1
                                ...
                                192.168.2.100
                                192.168.3.1
                                ...
                                192.168.3.100
* **MIXED**

Данный раздел содержит в себе несколько логинов и паролей для авторизации вперемешку

```yaml
GROUPS:
  group_1:
    login: Cisco
    password: Cisco
    devices_by_ip:
      - 192.168.1.0/24
      - 192.168.2.1-100
      - 192.168.3-4.222
    devices_by_name:
      - device_1
      - device_2
      - device_3

MIXED:
    login:
      - admin
      - Admin
      - administrator
    password:
      - admin
      - password
      - 12345678
```

##### Далее подключаемся к оборудованию

```python
session.connect()
```
При успешном подключении возвращает **True**, в случае неудачи **False**
#### Пример работы программы
    

    $ ./telnet_control/device_control.py  -N device_name -i 192.168.1.10 -m show-interfaces
        
        Подключаемся к device_name (192.168.1.10)
    
        Тип оборудования: Cisco
    
    ╒═════════════╤════════════╤════════╤═════════════╕
    │             │ Admin      │        │             │
    │ Interface   │ Status     │ Link   │ Description │
    ╞═════════════╪════════════╪════════╪═════════════╡
    │ Gi0/1       │ admin down │ down   │             │
    ├─────────────┼────────────┼────────┼─────────────┤
    │ Gi0/2       │ admin down │ down   │             │
    ├─────────────┼────────────┼────────┼─────────────┤
    │ Gi0/3       │ admin down │ down   │             │
    ├─────────────┼────────────┼────────┼─────────────┤
    │ Gi0/4       │ up         │ up     │ Printer_HP1 │
    ├─────────────┼────────────┼────────┼─────────────┤
    │ Gi0/5       │ admin down │ down   │             │
    ╘═════════════╧════════════╧════════╧═════════════╛

